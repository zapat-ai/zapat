# Zapat Configuration
# Copy to .env and fill in values: cp .env.example .env

# ─── GitHub ───────────────────────────────────────────────────────────
# GitHub organization or user that owns the repositories Zapat monitors.
GITHUB_ORG=your-org

# GitHub Personal Access Token (required for cron/headless use).
# Create at: https://github.com/settings/tokens/new
# Scopes needed: repo, read:org
GH_TOKEN=ghp_YOUR_TOKEN_HERE

# ─── Slack Notifications ──────────────────────────────────────────────
# Webhook URL for pipeline notifications (daily digests, failure alerts).
# Create at: https://api.slack.com/apps → Incoming Webhooks
# Leave blank to disable Slack notifications.
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# ─── Claude / AI Model ───────────────────────────────────────────────
# Which Claude model to use for all agent tasks.
# Options: claude-opus-4-6, claude-sonnet-4-5-20250929, claude-haiku-4-5-20251001
CLAUDE_MODEL=claude-sonnet-4-5-20250929

# ─── Automation Directory ─────────────────────────────────────────────
# Auto-detected from script location. Override only if your checkout
# lives somewhere unexpected.
# AUTOMATION_DIR=/home/you/zapat

# ─── Compliance Mode ─────────────────────────────────────────────────
# When true, enables extra compliance checks:
#   - Security scan prompts include domain-specific rules
#   - PR reviews check for regulatory violations
#   - Agents consult compliance persona before merging
# Set to true and provide a compliance agent in config/agents.conf
# for regulated industries (healthcare, finance, etc.).
ENABLE_COMPLIANCE_MODE=false

# ─── Timezone ─────────────────────────────────────────────────────────
# Timezone used for cron schedules, log timestamps, and digest timing.
# Uses IANA timezone names: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
TZ=America/New_York

# ─── Budget Caps (USD per invocation) ────────────────────────────────
# Budget caps for scheduled jobs (non-interactive, run via claude -p).
# These are hard-enforced: Claude Code stops when the cap is hit.
MAX_BUDGET_DAILY_STANDUP=5
MAX_BUDGET_WEEKLY_PLANNING=15
MAX_BUDGET_MONTHLY_STRATEGY=25
MAX_BUDGET_SECURITY_SCAN=15

# Note: Interactive agent sessions (implementation, triage, review, research,
# tests, rework) use agent teams in interactive mode, where Claude Code does
# not currently support budget caps. For these jobs, spending is controlled
# via the TIMEOUT_* settings below — the session is killed when time runs out.

# ─── @zapat Mentions ──────────────────────────────────────────────────
# Enable detection of @zapat mentions in issue/PR comments.
# When enabled, commenting "@zapat <instruction>" triggers the pipeline.
ZAPAT_MENTION_ENABLED=true

# GitHub login of the account running Zapat (prevents self-mention loops).
# Set this to your GitHub username or machine account login.
# ZAPAT_BOT_LOGIN=your-github-username

# ─── Auto-Triage ─────────────────────────────────────────────────────
# When enabled, Zapat automatically triages ALL new issues — no labels needed.
# New issues without any Zapat label are picked up, triaged by the agent team,
# and the triage agent decides whether to implement, research, or leave for humans.
# Issues with assignees or the "human-only" label are always skipped.
AUTO_TRIAGE_NEW_ISSUES=true

# ─── Polling ──────────────────────────────────────────────────────────
# How often the poller checks GitHub for new issues/PRs (minutes).
# GitHub allows 5,000 API requests/hour. Each poll cycle uses ~10-11 calls
# per repo (quiet) or ~15-20 (busy). At 2-min polling:
#   1-5 repos:  safe (< 30% of limit)
#   10 repos:   moderate (~ 50% of limit)
#   20+ repos:  consider increasing to 5 minutes
POLL_INTERVAL_MINUTES=2

# Max concurrent agent-work sessions (implementation + rework combined).
MAX_CONCURRENT_WORK=10

# ─── Timeouts (seconds) ──────────────────────────────────────────────
TIMEOUT_DAILY_STANDUP=600
TIMEOUT_WEEKLY_PLANNING=900
TIMEOUT_MONTHLY_STRATEGY=1200
TIMEOUT_PR_REVIEW=600
TIMEOUT_ISSUE_TRIAGE=600
TIMEOUT_IMPLEMENT=1800
TIMEOUT_TEST_PR=1200
TIMEOUT_WRITE_TESTS=1800
TIMEOUT_RESEARCH=1800

# ─── Auto-Rebase ─────────────────────────────────────────────────────
# When main changes, automatically rebase open Zapat PRs that are behind.
# Prevents stale PRs from silently diverging after parallel merges.
AUTO_REBASE_ENABLED=true

# ─── Auto-Merge ──────────────────────────────────────────────────────
# Whether to auto-merge agent PRs that pass all checks.
AUTO_MERGE_ENABLED=true

# Hours to wait after PR is approved before auto-merging.
# Gives humans a window to review before merge.
AUTO_MERGE_DELAY_HOURS=4

# Maximum risk level that can be auto-merged (low, medium, high).
# PRs above this risk level require manual merge.
AUTO_MERGE_MAX_RISK=medium

# ─── Dashboard ────────────────────────────────────────────────────────
# Port for the Next.js dashboard (run with: bin/zapat dashboard).
DASHBOARD_PORT=8080
